name: Unit tests

on: [push]

jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
        e2e: [sh tests.sh, powershell.exe -file tests.ps1]
        exclude:
          - os: ubuntu-latest
            e2e:  powershell.exe -file tests.ps1
          - os: ubuntu-latest
            e2e: sh tests.sh

    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@v1

    - uses: mihails-strasuns/setup-dlang@v1
      name: Install DMD

    - name: Build
      run: dub build

    - name: Unit tests
      run: dub test --coverage

    - name: e2e tests
      run: ${{ matrix.e2e }}


